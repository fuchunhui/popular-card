import{d as A,o as w,c as T,a as m,u as y,b as Y,r as Q,n as Z,t as ee,i as te,e as x,f as ne,g as v,w as oe,v as se,h as ue}from"./vendor.abfcf515.js";const ae=function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))s(t);new MutationObserver(t=>{for(const u of t)if(u.type==="childList")for(const l of u.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&s(l)}).observe(document,{childList:!0,subtree:!0});function a(t){const u={};return t.integrity&&(u.integrity=t.integrity),t.referrerpolicy&&(u.referrerPolicy=t.referrerpolicy),t.crossorigin==="use-credentials"?u.credentials="include":t.crossorigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function s(t){if(t.ep)return;t.ep=!0;const u=a(t);fetch(t.href,u)}};ae();const P="https://juejin.cn/post/7047529302140649486";const re={class:"color-wrap"},le={class:"logo"},ce=["href"],ie=m("div",{class:"color-wrap-content"},[m("p",null,"\u8FD9\u662F\u4EC0\u4E48\uFF1F\u662F\u60CA\u559C\u8FD8\u662F\u610F\u5916\uFF0C\u662F bug \u8FD8\u662F\u5F69\u86CB\uFF1F\u8BA9\u6211\u4EEC\u4E00\u8D77\u522E\u522E\u522E\uFF0C\u597D\u73A9\u5C31\u53BB\u70B9\u4E2A\u8D5E\u3002")],-1),de={class:"color-wrap-footer"},fe=Y(" \u8BE6\u7EC6\u5185\u5BB9 "),he=["href"],pe=A({setup(e){return(n,a)=>(w(),T("div",re,[m("div",le,[m("a",{href:y(P),target:"_blank"},"\u522E\u522E\u4E50\u8868\u60C5\u5305\u5927\u6218",8,ce)]),ie,m("div",de,[fe,m("a",{href:y(P),target:"_blank"},"\u672A\u6765\u6587\u7AE0\u6807\u9898",8,he)])]))}});const M=A({props:{label:{type:String,default:"\u63D0\u4EA4"},disabled:{type:Boolean,default:!1}},setup(e){return(n,a)=>(w(),T("button",{class:Z(["popular-button",{disabled:e.disabled}])},[Q(n.$slots,"default",{},()=>[Y(ee(e.label),1)])],2))}}),j="STORY",ge="TEXT",me="SPECIAL",W="MYSTERY",_e="https://sql.js.org/dist/",Ee="./db/popular.db",ye=await te({locateFile:e=>`${_e}${e}`}),Fe=await fetch(Ee).then(e=>e.arrayBuffer()),ve=new ye.Database(new Uint8Array(Fe)),H=()=>ve,Ce=(e,n="title")=>{const a=H().prepare(`SELECT * FROM ${j} INNER JOIN ${ge} USING(mid) WHERE ${n} = :val`),s=a.getAsObject({":val":e});return a.free(),s},G=(e=W,n="*")=>{const a=`SELECT ${n} FROM ${e} ORDER BY RANDOM() limit 1`,s=H().prepare(a),t=s.getAsObject({});return s.free(),t},X=["23333","\u540E\u7AEF\u5927\u4F6C","\u524D\u7AEF","\u4EA7\u54C1\u7ECF\u7406","\u6D4B\u8BD5\u5C0F\u5F1F","\u5403\u74DC\u7FA4\u4F17","\u6253\u5DE5\u4EBA","\u5927\u4F19","\u5927\u5BB6","\u5927\u4F6C","\u5E72\u996D\u4EBA","\u5DE5\u5177\u4EBA","\u74DC\u5A03\u5B50","\u97ED\u83DC","\u67D0\u540C\u5B66","\u5E74\u8F7B\u4EBA","\u6C14\u6C1B\u7EC4","\u6211\u6EF4\u4E56\u4E56","\u5C0F\u53EF\u7231","\u5144\u5F1F\u4EEC","\u4E00\u8D77\u722C\u5C71\uFF1F","\u7EDD\u7EDD\u5B50"],Be=()=>X[Math.floor(Math.random()*X.length)],be=()=>{let e="";const n=Math.floor(Math.random()*100);if(n<30)e=j;else if(n<70)e=W;else return{special:!0};const{title:a,text:s}=G(e),t=Be();return{command:a,text:s||t,special:!1}},De=()=>{const{command:e,text:n,special:a}=be();if(a){const{image:t}=G(me,"image");return{special:a,image:t}}const s=Ce(e||"","title");return delete s.id,delete s.mid,delete s.tid,{special:a,text:n,...s}},Ae=1.2,we=(e,n,a)=>{let s=0,t=e.length-1;for(;s<=t;){const u=Math.floor((s+t)/2),l=a.measureText(e.substring(0,u)).width,i=a.measureText(e.substring(0,u+1)).width;if(l<=n&&i>n)return u;l<n?s=u+1:t=u-1}return-1},Te=(e,n,a)=>{const s=[];let t=0;for(;(t=we(e,n,a))!==-1;)s.push(e.substring(0,t)),e=e.substring(t);return e&&s.push(e),s},xe=(e,n,a,s)=>{const{x:t,y:u,font:l,color:i,align:R,max:f,direction:F,blur:_}=s;e.font=l||"32px sans-serif",e.fillStyle=i||"#000000",_&&(e.filter=`blur(${_}px)`),e.textAlign=R||"center";const h=f||n,S=Me(l),C=Te(a,h,e);C.forEach((L,B)=>{const b=F==="down"?B:B-(C.length-1);e.fillText(L,t,u+b*S*Ae,h)})},Me=e=>{const n=e.match(/(\d{1,3})px/)||["","32"];return Number(n[1])},Re=(e,n,a)=>{const t=`image/${["jpeg","jpg"].includes(n)?"jpeg":"png"}`,u=e.toDataURL(t),l=document.createElement("a");l.setAttribute("download",a),l.setAttribute("href",u),l.setAttribute("target","_blank"),l.click()};const Se={class:"card"},Le={class:"card-btn"},Pe=m("div",{class:"card-btn-left"},null,-1),ke=A({setup(e){const n=x(null),a=x(null),s=x(null);let t=document.createElement("canvas"),u=document.createElement("canvas"),l=100,i=100;const R=75,f=new Image;let F=!1,_=x(!0),h={x:0,y:0};const S=o=>{f.onload=async()=>{t=a.value,t.width=l,t.height=i;let r=f.naturalWidth,c=f.naturalHeight;r>l&&(r=l,c=l*f.naturalHeight/f.naturalWidth),c>i&&(c=i,r=i*f.naturalWidth/f.naturalHeight);const p=l-r,d=i-c,g=Math.floor(Math.random()*p),E=Math.floor(Math.random()*d);L(o,g,E)},f.onerror=r=>{console.error(r)},f.src=o.image},C=()=>{u=s.value,u.width=l,u.height=i;const o=u.getContext("2d");B(o),_.value=!0},L=(o,r=0,c=0)=>{const p=t.getContext("2d");p.drawImage(f,r,c);const{special:d,text:g}=o;d||xe(p,t.width,g||"",o)},B=o=>{o.save(),o.fillStyle="#d9c58e",o.fillRect(0,0,l,i),o.restore()},b=o=>{F=!0,h=$(o,u)},k=o=>{if(!F)return;const r=u.getContext("2d"),c=$(o,u),p=Math.sqrt(Math.pow(c.x-h.x,2)+Math.pow(c.y-h.y,2)),d=Math.atan2(c.x-h.x,c.y-h.y);let g=0,E=0;for(let D=0;D<p;D++)g=h.x+Math.sin(d)*D,E=h.y+Math.cos(d)*D,r.globalCompositeOperation="destination-out",r.beginPath(),r.fillStyle="#fff",r.arc(g,E,20,0,Math.PI*2,!0),r.fill(),r.closePath();h=c,q()},O=()=>{F=!1},$=(o,r)=>{let c=0,p=0;if(r.offsetParent!==void 0)do c+=r.offsetLeft,p+=r.offsetTop;while(r=r.offsetParent);let d=0,g=0;return/Android|webOS|iPhone|iPod|iPad|BlackBerry|SymbianOS/.test(navigator.userAgent)?(d=o.touches[0].clientX,g=o.touches[0].clientY):(d=o.pageX,g=o.pageY),{x:d-c,y:g-p}},q=()=>{const c=u.getContext("2d").getImageData(0,0,l,i).data,p=16;let d=0;for(let E=0;E<c.length;E+=p)parseInt(c[E].toString())===0&&d++;Math.round(d*p/c.length*100)>R&&(_.value=!1)},z=()=>{V(),N(),C()},J=()=>{const o=new Date().getTime().toString().slice(-6);Re(t,"png",`\u798F\u864E\u751F\u5A01_${o}`)},I=()=>{window.open(P)},U=()=>{if(!n.value)return;const{width:o,height:r}=n.value.getBoundingClientRect();l=o,i=r},N=()=>{const o=De();S(o)},V=()=>{F=!1,_.value=!0,h={x:0,y:0}},K=()=>{!s.value||!_.value||!n.value||setInterval(()=>{const o=document.getElementsByClassName("canvas-layer");_.value&&o.length!==1&&n.value.appendChild(s.value)},300)};return ne(()=>{U(),N(),C(),K()}),(o,r)=>(w(),T("div",Se,[m("div",Le,[Pe,v(y(M),{u:"primary",label:"\u518D\u6765\u4E00\u6B21\uFF1F",onClick:z}),v(y(M),{u:"primary",label:"\u4FDD\u5B58\uFF0C\u79C0\u4E00\u4E0B",onClick:J}),v(y(M),{u:"primary",label:"\u611F\u89C9\u4E0D\u9519\uFF0C\u53BB\u70B9\u4E2A\u8D5E\uFF01",onClick:I}),v(y(M),{u:"primary",label:"\u5783\u573E\uFF0C\u53BB\u5410\u69FD",onClick:I})]),m("div",{class:"card-canvas",ref_key:"cardCanvas",ref:n},[m("canvas",{ref_key:"canvasRef",ref:a},null,512),oe(m("canvas",{ref_key:"layerRef",ref:s,class:"canvas-layer",onMousedown:b,onMousemove:k,onMouseup:O,onTouchstart:b,onTouchmove:k,onTouchend:O},null,544),[[se,y(_)]])],512)]))}});const Oe={class:"container"},$e=A({setup(e){return(n,a)=>(w(),T("div",Oe,[v(pe),v(ke)]))}});ue($e).mount("#app");
